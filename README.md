

<!-- markdownlint-disable -->
<a href="https://cpco.io/homepage"><img src="https://github.com/cloudposse-terraform-components/aws-tgw-attachment/blob/main/.github/banner.png?raw=true" alt="Project Banner"/></a><br/>
    <p align="right">
<a href="https://github.com/cloudposse-terraform-components/template/releases/latest"><img src="https://img.shields.io/github/release/cloudposse-terraform-components/template.svg?style=for-the-badge" alt="Latest Release"/></a><a href="https://slack.cloudposse.com"><img src="https://slack.cloudposse.com/for-the-badge.svg" alt="Slack Community"/></a></p>
<!-- markdownlint-restore -->

<!--




  ** DO NOT EDIT THIS FILE
  **
  ** This file was automatically generated by the `cloudposse/build-harness`.
  ** 1) Make all changes to `README.yaml`
  ** 2) Run `make init` (you only need to do this once)
  ** 3) Run`make readme` to rebuild this file.
  **
  ** (We maintain HUNDREDS of open source projects. This is how we maintain our sanity.)
  **





-->

This component creates a Transit Gateway VPC Attachment and optionally creates an association with a Transit Gateway Route Table.


> [!TIP]
> #### ðŸ‘½ Use Atmos with Terraform
> Cloud Posse uses [`atmos`](https://atmos.tools) to easily orchestrate multiple environments using Terraform. <br/>
> Works with [Github Actions](https://atmos.tools/integrations/github-actions/), [Atlantis](https://atmos.tools/integrations/atlantis), or [Spacelift](https://atmos.tools/integrations/spacelift).
>
> <details>
> <summary><strong>Watch demo of using Atmos with Terraform</strong></summary>
> <img src="https://github.com/cloudposse/atmos/blob/main/docs/demo.gif?raw=true"/><br/>
> <i>Example of running <a href="https://atmos.tools"><code>atmos</code></a> to manage infrastructure from our <a href="https://atmos.tools/quick-start/">Quick Start</a> tutorial.</i>
> </detalis>





## Usage

**Stack Level**: Regional or Test47

Here's an example snippet for how to use this component.

```yaml
components:
  terraform:
    tgw/attachment:
      vars:
        enabled: true
        transit_gateway_id: !terraform.output tgw/hub core-use1-network transit_gateway_id
        transit_gateway_route_table_id: !terraform.output tgw/hub core-use1-network transit_gateway_route_table_id
        create_transit_gateway_route_table_association: false
```

#### Transit Gateway Route Table Association

If you have a Transit Gateway Route Table, you can create an association with the Transit Gateway VPC Attachment. This is necessary for attachments in the _same account_ as the Transit Gateway Route Table. For example, if you have a Transit Gateway Route Table in the _core_ account, you will need to create an association for each of the VPCs in the _core_ account.

```yaml
# core-network stack
components:
  terraform:
    tgw/attachment:
      vars:
        enabled: true
        transit_gateway_id: !terraform.output tgw/hub core-use1-network transit_gateway_id
        transit_gateway_route_table_id: !terraform.output tgw/hub core-use1-network transit_gateway_route_table_id
        create_transit_gateway_route_table_association: true
```

#### Additional Associations

If you have peered connections to other VPCs, you may need to create associations for each of those VPCs. You typically need these associations created in the same account as the peered Transit Gateway.

```yaml
# core-usw2-network stack (example alternative region)
components:
  terraform:
    tgw/attachment:
      vars:
        enabled: true
        transit_gateway_id: !terraform.output tgw/hub core-usw2-network transit_gateway_id
        transit_gateway_route_table_id: !terraform.output tgw/hub core-usw2-network transit_gateway_route_table_id
        create_transit_gateway_route_table_association: true

        # Add associations for the peered VPCs' Transit Gateway Attachments
        additional_associations:
          - attachment_id: !terraform.output tgw/attachment plat-usw2-dev transit_gateway_attachment_id
            route_table_id: !terraform.output tgw/hub transit_gateway_route_table_id
          - attachment_id: !terraform.output tgw/attachment plat-usw2-prod transit_gateway_attachment_id
            route_table_id: !terraform.output tgw/hub transit_gateway_route_table_id
```

> [!IMPORTANT]
> In Cloud Posse's examples, we avoid pinning modules to specific versions to prevent discrepancies between the documentation
> and the latest released versions. However, for your own projects, we strongly advise pinning each module to the exact version
> you're using. This practice ensures the stability of your infrastructure. Additionally, we recommend implementing a systematic
> approach for updating versions to avoid unexpected changes.
